# Actuator

L’attuatore si mette in ascolto di messaggi ricevuti dal backend. In particolare, i messaggi vengono ricevuti su due endpoint differenti:

* */sensor_properties*: tramite questo, l’attuatore riceve dal backend la lista dei sensori della stanza aggiornata. In questo modo l’attuatore viene sempre aggiornato dal backend sui sensori presenti nella stanza e sui loro stati attuali. L’attuatore, salva gli aggiornamenti in memoria e successivamente inoltra la lista al microservizio thermometer, verso l’indirizzo http://thermometer-service:3000/room_properties, tramite REST. 
* */command*: tramite questo, l’attuatore riceve dal backend i comandi da inoltrare ai sensori inseriti dall’utente. In questo caso l’attuatore si occupa di validare la correttezza dei comandi ricevuti. Nel caso in cui il comando non sia considerato valido, ovvero il risultato del cambiamento di stato richiesto dall’utente è uguale allo stato corrente del sensore (ad esempio l’utente chiede di aprire una finestra già aperta) l’attuatore restituisce al backend una risposta di errore tramite il codice 304: Not Modified.  Se, invece, il comando è considerato valido, esso viene propagato al microservizio del sensore utilizzando il backchannel corretto. Questa comunicazione avviene tramite REST. In particolare, viene utilizzato l’endpoint '/change-state' se l’azione riguarda un cambiamento di stato (ON_OPEN=1 o OFF_CLOSE=0), oppure l’endpoint '/add-sensor' se invece riguarda un’aggiunta (ADD = 2) o una rimozione di un sensore (REMOVE = 3).   
 
Per simulare lo spegnimento del microservizio viene chiamato nel codice *process.exit()* dopo 3 azioni (aggiunte e/o rimozioni) di un sensore di tipo termometro. In questo modo grazie all’opzione restart in docker-compose il container viene riavviato senza causare l’interruzione dell’intero sistema.

